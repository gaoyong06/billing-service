# ============================================
# Billing Service 配置文件
# ============================================

# 服务器配置
server:
  # HTTP 服务器配置（面向前端/开发者）
  http:
    # HTTP 服务监听地址，格式: IP:PORT
    addr: 0.0.0.0:8107
    # HTTP 请求超时时间
    timeout: 1s
  # gRPC 服务器配置（面向内部服务）
  grpc:
    # gRPC 服务监听地址，格式: IP:PORT
    addr: 0.0.0.0:9107
    # gRPC 请求超时时间
    timeout: 1s

# 数据层配置
data:
  # 数据库配置
  database:
    # 数据库驱动类型，目前支持: mysql
    driver: mysql
    # 数据库连接字符串
    # 格式: user:password@tcp(host:port)/database?charset=utf8mb4&parseTime=True&loc=Local
    source: root:@tcp(127.0.0.1:3306)/billing_service?charset=utf8mb4&parseTime=True&loc=Local
  # Redis 配置（用于缓存和分布式锁）
  redis:
    # Redis 服务器地址，格式: IP:PORT
    addr: 127.0.0.1:6379
    # Redis 读取超时时间
    read_timeout: 0.2s
    # Redis 写入超时时间
    write_timeout: 0.2s
  # RocketMQ 消息队列配置
  rocketmq:
    name_servers:
      - "127.0.0.1:9876"
    group_name: "billing_deduct_group"
    topic: "billing_deduct_queue"
    retry_times: 2
    send_timeout: 3s
    enabled: true

# 计费业务配置
billing:
  # 各服务的单价配置（单位：元/次）
  # 当用户免费额度用完后，按此价格从余额中扣费
  prices:
    passport: 0.01  # Passport 服务单价：0.01 元/次
    payment: 0.10   # Payment 服务单价：0.10 元/次
    asset: 0.05     # Asset 服务单价：0.05 元/次
  
  # 各服务的免费额度配置（单位：次/月）
  # 每月自动重置，用户首次调用时自动创建当月额度记录
  free_quotas:
    passport: 10000  # Passport 服务免费额度：10000 次/月
    payment: 1000    # Payment 服务免费额度：1000 次/月
    asset: 1000      # Asset 服务免费额度：1000 次/月
  
  # 余额低阈值（单位：元）
  # 当用户余额低于此值时，会触发告警指标（BalanceLowAlert）
  # 用于监控用户余额不足的情况
  balance_low_threshold: 10.0
  
  # 配额低阈值（百分比）
  # 当用户剩余免费额度低于总额度的此百分比时，会触发告警指标（QuotaLowAlert）
  # 例如：总额度 10000，阈值 20%，则剩余 < 2000 时触发告警
  quota_low_percent_threshold: 20.0

# 支付服务配置（用于充值功能）
payment_service:
  # Payment Service 的 gRPC 服务地址
  # 用于创建支付订单和查询支付状态
  grpc_addr: 127.0.0.1:9101
  # 调用 Payment Service 的超时时间
  timeout: 5s
  # 支付成功后的返回 URL（用户支付完成后跳转的页面）
  return_url: http://localhost:3000/callback
  # 支付回调通知 URL（Payment Service 支付完成后回调此地址）
  notify_url: http://localhost:8107/internal/v1/billing/callback
